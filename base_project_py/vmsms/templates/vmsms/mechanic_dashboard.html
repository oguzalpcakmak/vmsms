{% extends 'vmsms/base.html' %}
{% block title %}Mechanic Dashboard | VMSMS{% endblock %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-md-12 col-lg-10">
    <div class="card p-4 shadow">
      <div class="text-center mb-4">
        <h2 class="mb-0">
          <i class="fas fa-tools me-2 text-primary"></i>
          Mechanic Dashboard
        </h2>
        <p class="text-muted mt-2">Welcome, {{ mechanic.name }} {{ mechanic.surname }}</p>
      </div>
      
      <!-- Workflow Overview -->
      <div class="alert alert-info mb-4">
        <h6 class="alert-heading"><i class="fas fa-info-circle me-2"></i>Workflow Guide</h6>
        <p class="mb-0">
          <strong>1. Appointments</strong> → <strong>2. Assign Tests</strong> → <strong>3. Diagnose Tests</strong> → <strong>4. Suggest Repairs</strong> → <strong>5. Complete Repairs</strong>
        </p>
      </div>
      
      <div class="row g-4 mb-4">
        <div class="col-md-6">
          <div class="card border-primary h-100">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0">
                <i class="fas fa-calendar-check me-2"></i>Appointment Management
              </h5>
            </div>
            <div class="card-body">
              <a href="{% url 'vmsms:appointment_list' %}" class="btn btn-outline-primary w-100">
                <i class="fas fa-list me-2"></i>View My Appointments
              </a>
            </div>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="card border-success h-100">
            <div class="card-header bg-success text-white">
              <h5 class="mb-0">
                <i class="fas fa-clipboard-list me-2"></i>Testing & Diagnostics
              </h5>
            </div>
            <div class="card-body">
              <a href="{% url 'vmsms:test_list' %}" class="btn btn-outline-success w-100">
                <i class="fas fa-list me-2"></i>View My Tests
              </a>
            </div>
          </div>
        </div>
      </div>
      
      <div class="row g-4 mb-4">
        <div class="col-md-6">
          <div class="card border-info h-100">
            <div class="card-header bg-info text-white">
              <h5 class="mb-0">
                <i class="fas fa-stethoscope me-2"></i>Diagnosis & Repair
              </h5>
            </div>
            <div class="card-body">
              <a href="{% url 'vmsms:test_list' %}" class="btn btn-outline-info w-100 mb-2">
                <i class="fas fa-stethoscope me-2"></i>Diagnose Tests
              </a>
              <a href="{% url 'vmsms:appointment_list' %}" class="btn btn-outline-info w-100">
                <i class="fas fa-wrench me-2"></i>Manage Repairs
              </a>
            </div>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="card border-warning h-100">
            <div class="card-header bg-warning text-dark">
              <h5 class="mb-0">
                <i class="fas fa-user-edit me-2"></i>Profile & Settings
              </h5>
            </div>
            <div class="card-body">
              <a href="{% url 'vmsms:edit_profile' %}" class="btn btn-outline-warning w-100 mb-2">
                <i class="fas fa-user-cog me-2"></i>Edit Profile
              </a>
              <a href="{% url 'vmsms:logout' %}" class="btn btn-outline-warning w-100">
                <i class="fas fa-sign-out-alt me-2"></i>Logout
              </a>
            </div>
          </div>
        </div>
      </div>
      
      <div class="row g-4 mb-4">
        <div class="col-md-6">
          <div class="card border-secondary h-100">
            <div class="card-header bg-secondary text-white">
              <h5 class="mb-0">
                <i class="fas fa-users me-2"></i>Customer Management
              </h5>
            </div>
            <div class="card-body">
              <a href="{% url 'vmsms:user_list' %}" class="btn btn-outline-secondary w-100">
                <i class="fas fa-users-cog me-2"></i>Customer List
              </a>
            </div>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="card border-dark h-100">
            <div class="card-header bg-dark text-white">
              <h5 class="mb-0">
                <i class="fas fa-car me-2"></i>Vehicle Management
              </h5>
            </div>
            <div class="card-body">
              <a href="{% url 'vmsms:vehicle_list' %}" class="btn btn-outline-dark w-100">
                <i class="fas fa-car me-2"></i>Manage Vehicles
              </a>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Mechanic Information Section -->
      <div class="row g-4 mb-4">
        <div class="col-md-6">
          <div class="card border-secondary h-100">
            <div class="card-header bg-secondary text-white">
              <h5 class="mb-0">
                <i class="fas fa-user me-2"></i>Professional Information
              </h5>
            </div>
            <div class="card-body">
              <ul class="list-group list-group-flush">
                <li class="list-group-item d-flex justify-content-between">
                  <span><i class="fas fa-user me-2"></i>Username:</span>
                  <strong>{{ mechanic.username }}</strong>
                </li>
                <li class="list-group-item d-flex justify-content-between">
                  <span><i class="fas fa-phone me-2"></i>Phone:</span>
                  <strong>{{ mechanic.phone_number|default:"Not provided" }}</strong>
                </li>
                <li class="list-group-item d-flex justify-content-between">
                  <span><i class="fas fa-dollar-sign me-2"></i>Service Fee:</span>
                  <strong>{{ mechanic.service_fee|default:"Not set" }}</strong>
                </li>
                <li class="list-group-item d-flex justify-content-between">
                  <span><i class="fas fa-certificate me-2"></i>Specialization:</span>
                  <strong>{{ mechanic.specialization_code|default:"Not set" }}</strong>
                </li>
              </ul>
            </div>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="card border-dark h-100">
            <div class="card-header bg-dark text-white">
              <h5 class="mb-0">
                <i class="fas fa-clock me-2"></i>Schedule Information
              </h5>
            </div>
            <div class="card-body">
              {% if schedule %}
              <ul class="list-group list-group-flush">
                <li class="list-group-item d-flex justify-content-between">
                  <span><i class="fas fa-calendar me-2"></i>Date:</span>
                  <strong>{{ schedule.date }}</strong>
                </li>
                <li class="list-group-item d-flex justify-content-between">
                  <span><i class="fas fa-clock me-2"></i>Time:</span>
                  <strong>{{ schedule.time }}</strong>
                </li>
                <li class="list-group-item d-flex justify-content-between">
                  <span><i class="fas fa-check-circle me-2"></i>Availability:</span>
                  <strong>{{ schedule.availability }}</strong>
                </li>
              </ul>
              {% else %}
              <div class="text-center py-3">
                <i class="fas fa-calendar-times fa-2x text-muted mb-2"></i>
                <p class="text-muted mb-0">No schedule set</p>
              </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
      
      <!-- Recent Appointments Table -->
      <div class="card border-primary mb-4">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">
            <i class="fas fa-calendar-check me-2"></i>Recent Appointments
          </h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-bordered table-hover align-middle">
              <thead class="table-light">
                <tr>
                  <th>ID</th>
                  <th>Time</th>
                  <th>Vehicle</th>
                  <th>Customer</th>
                  <th>Service Type</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for appt in appointments %}
                <tr>
                  <td>{{ appt.appointment_id }}</td>
                  <td>{{ appt.appointment_time|date:"M d, Y H:i" }}</td>
                  <td>{{ appt.vehicle }}</td>
                  <td>{{ appt.customer.name }}</td>
                  <td>
                    <span class="badge {% if appt.service_type == 'repair' %}bg-warning{% else %}bg-info{% endif %}">
                      {{ appt.service_type|title }}
                    </span>
                  </td>
                  <td>
                    {% if appt.service_type == 'test' %}
                      {% if appt.test_completed %}
                        <span class="badge bg-success">Completed</span>
                      {% else %}
                        <span class="badge bg-warning">Pending</span>
                      {% endif %}
                    {% else %}
                      {% if appt.repair_approved %}
                        <span class="badge bg-success">Approved</span>
                      {% else %}
                        <span class="badge bg-warning">Pending</span>
                      {% endif %}
                    {% endif %}
                  </td>
                  <td>
                    <div class="btn-group" role="group">
                      <a href="{% url 'vmsms:appointment_detail' appt.id %}" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-eye"></i>
                      </a>
                      {% if appt.service_type == 'test' and not appt.test_completed %}
                        <a href="{% url 'vmsms:test_create' %}" class="btn btn-sm btn-outline-success">
                          <i class="fas fa-plus"></i> Assign Test
                        </a>
                      {% endif %}
                    </div>
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="7" class="text-center text-muted">
                    <i class="fas fa-calendar-times me-2"></i>No appointments found
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} 